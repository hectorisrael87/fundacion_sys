{% extends "base.html" %}
{% block title %}{{ cc.number }} - Precios{% endblock %}

{% block content %}
<div class="modal">
  <a class="modal-backdrop" href="{% url 'cc_detail' cc.pk %}" aria-label="Cerrar"></a>

  <div class="modal-panel">
    <div class="card">
      <div class="modal-header">
        <div>
          <h2 class="m0">{{ cc.number }} â€“ Matriz de precios</h2>
          <div class="muted mt-xs">Ingresa el <b>precio unitario</b> por producto y proveedor.</div>
          {% if cc_bloqueado %}
            <div class="muted mt-sm">ðŸ”’ El cuadro estÃ¡ aprobado: la matriz estÃ¡ en modo lectura.</div>
          {% endif %}
        </div>
        <a class="btn btn-ghost btn-sm" href="{% url 'cc_detail' cc.pk %}">âœ•</a>
      </div>

      {% if not items %}
        <div class="mt-md">
          <p><b>No hay productos.</b> Primero agrega productos.</p>
          <a class="btn btn-ghost" href="{% url 'cc_detail' cc.pk %}">Volver</a>
        </div>

      {% elif not proveedores %}
        <div class="mt-md">
          <p><b>No hay proveedores.</b> Primero agrega proveedores.</p>
          <a class="btn btn-ghost" href="{% url 'cc_detail' cc.pk %}">Volver</a>
        </div>

      {% else %}
        <form method="post" class="mt-md">
          {% csrf_token %}

          <div class="table-scroll">
            <table class="table minw-900">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Unidad</th>
                  <th class="text-right">Cant.</th>

                  {% for ps in proveedores %}
                    <th class="text-right">{{ ps.proveedor.nombre_empresa }}</th>
                  {% endfor %}
                </tr>
              </thead>

              <tbody>
                {% for fila in matriz %}
                  <tr>
                    <td>{{ fila.item.producto.nombre }}</td>
                    <td>{{ fila.item.unidad }}</td>
                    <td class="text-right">{{ fila.item.cantidad }}</td>

                    {% for c in fila.celdas %}
                      <td class="text-right">
                        <input
                          class="control control-cell"
                          type="text"
                          inputmode="decimal"
                          name="precio_{{ c.proveedor_id }}_{{ c.producto_id }}"
                          value="{{ c.precio_unit|floatformat:2 }}"
                          {% if cc_bloqueado %}disabled{% endif %}
                        />
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="modal-actions">
            {% if not cc_bloqueado %}
              <button class="btn btn-primary" type="submit">ðŸ’¾ Guardar precios</button>
            {% endif %}
            <a class="btn btn-ghost" href="{% url 'cc_detail' cc.pk %}">Volver</a>
          </div>
        </form>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
