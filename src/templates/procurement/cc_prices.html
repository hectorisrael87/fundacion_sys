{% extends "base.html" %}
{% block title %}{{ cc.number }} - Precios{% endblock %}

{% block content %}
<div class="card">
  <h2>{{ cc.number }} â€“ Matriz de precios</h2>
  <p>Ingrese el <b>precio unitario</b> por producto y proveedor.</p>

  {% if not items %}
    <p><b>No hay productos.</b> Primero agregue productos.</p>
    <a href="{% url 'cc_detail' cc.pk %}">Volver</a>
  {% elif not proveedores %}
    <p><b>No hay proveedores.</b> Primero agregue proveedores.</p>
    <a href="{% url 'cc_detail' cc.pk %}">Volver</a>
  {% else %}

  <form method="post">
    {% csrf_token %}

    <table style="width:100%; border-collapse: collapse; margin-top: 12px;">
      <thead>
        <tr>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Producto</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Unidad</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid #e5e7eb;">Cant.</th>

          {% for ps in proveedores %}
            <th style="text-align:right; padding:8px; border-bottom:1px solid #e5e7eb;">
              {{ ps.proveedor.nombre_empresa }}
            </th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for fila in matriz %}
          <tr>
            <td style="padding:8px; border-bottom:1px solid #f0f0f0;">{{ fila.item.producto.nombre }}</td>
            <td style="padding:8px; border-bottom:1px solid #f0f0f0;">{{ fila.item.unidad }}</td>
            <td style="padding:8px; border-bottom:1px solid #f0f0f0; text-align:right;">{{ fila.item.cantidad }}</td>

            {% for c in fila.celdas %}
              <td style="padding:8px; border-bottom:1px solid #f0f0f0; text-align:right;">
                <input
                    type="text"
                    inputmode="decimal"
                    name="precio_{{ c.proveedor_id }}_{{ c.producto_id }}"
                    value="{{ c.precio_unit|floatformat:2 }}"
                    style="width:120px; text-align:right;"
                />

              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div style="margin-top: 12px;">
      <button type="submit">Guardar precios</button>
      <a href="{% url 'cc_detail' cc.pk %}" style="margin-left:10px;">Volver</a>
    </div>
  </form>

  {% endif %}
</div>
{% endblock %}
